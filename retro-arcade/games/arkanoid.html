<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Arkanoid</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <!-- Back button with sound -->
  <button id="backBtn" onclick="playSound('back'); window.location.href='../index.html'">â¬… Back to Arcade</button>

  <div id="overlay">
    <div class="game-message" id="gameMessage">GAME OVER</div>
    <div class="restart-message">Press Enter to Restart</div>
  </div>

  <canvas id="arkanoid" width="480" height="320"></canvas>

<script src="../js/sound.js"></script>
<script>
const canvas = document.getElementById("arkanoid");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");
const gameMessage = document.getElementById("gameMessage");

let ball, paddle, bricks, score, lives, gameOver, game;

const brickRowCount = 4;
const brickColumnCount = 6;
const brickWidth = 60;
const brickHeight = 20;
const brickPadding = 10;
const brickOffsetTop = 30;
const brickOffsetLeft = 30;

function initGame(){
  ball = { x: canvas.width/2, y: canvas.height-30, dx: 3, dy: -3, r: 10 };
  paddle = { h: 10, w: 75, x: (canvas.width-75)/2 };
  score = 0;
  lives = 3;
  gameOver = false;
  overlay.style.display = "none";

  bricks = [];
  for(let c=0;c<brickColumnCount;c++){
    bricks[c] = [];
    for(let r=0;r<brickRowCount;r++){
      bricks[c][r] = { x:0, y:0, status:1 };
    }
  }

  clearInterval(game);
  game = setInterval(draw,20);
}

document.addEventListener("keydown", keyDownHandler);
document.addEventListener("keyup", keyUpHandler);

let rightPressed=false, leftPressed=false;

function keyDownHandler(e){
  if(e.key==="ArrowRight") rightPressed=true;
  else if(e.key==="ArrowLeft") leftPressed=true;
  if(e.key==="Enter" && gameOver){ initGame(); }
}
function keyUpHandler(e){
  if(e.key==="ArrowRight") rightPressed=false;
  else if(e.key==="ArrowLeft") leftPressed=false;
}

function collisionDetection(){
  for(let c=0;c<brickColumnCount;c++){
    for(let r=0;r<brickRowCount;r++){
      let b=bricks[c][r];
      if(b.status===1){
        if(ball.x> b.x && ball.x< b.x+brickWidth && ball.y> b.y && ball.y< b.y+brickHeight){
          ball.dy=-ball.dy;
          b.status=0;
          score++;
          playSound("arkanoid-brick"); // brick break sound
          if(score===brickRowCount*brickColumnCount){
            clearInterval(game);
            gameOver=true;
            overlay.style.display = "flex";
            gameMessage.textContent = "YOU WIN!";
            playSound("win"); // win sound
          }
        }
      }
    }
  }
}

function drawBall(){
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
  ctx.fillStyle="#ff0";
  ctx.fill();
  ctx.closePath();
}
function drawPaddle(){
  ctx.beginPath();
  ctx.rect(paddle.x,canvas.height-paddle.h,paddle.w,paddle.h);
  ctx.fillStyle="#0ff";
  ctx.fill();
  ctx.closePath();
}
function drawBricks(){
  for(let c=0;c<brickColumnCount;c++){
    for(let r=0;r<brickRowCount;r++){
      if(bricks[c][r].status===1){
        let brickX=(c*(brickWidth+brickPadding))+brickOffsetLeft;
        let brickY=(r*(brickHeight+brickPadding))+brickOffsetTop;
        bricks[c][r].x=brickX;
        bricks[c][r].y=brickY;
        ctx.beginPath();
        ctx.rect(brickX,brickY,brickWidth,brickHeight);
        ctx.fillStyle="#f0f";
        ctx.fill();
        ctx.closePath();
      }
    }
  }
}
function drawScore(){
  ctx.font="16px Arial";
  ctx.fillStyle="#fff";
  ctx.fillText("Score: "+score,8,20);
}
function drawLives(){
  ctx.font="16px Arial";
  ctx.fillStyle="#fff";
  ctx.fillText("Lives: "+lives,canvas.width-65,20);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBricks();
  drawBall();
  drawPaddle();
  drawScore();
  drawLives();
  collisionDetection();

  if(gameOver){ return; }

  if(ball.x+ball.dx>canvas.width-ball.r || ball.x+ball.dx<ball.r){ ball.dx=-ball.dx; playSound("arkanoid-paddle"); }
  if(ball.y+ball.dy<ball.r){ ball.dy=-ball.dy; }
  else if(ball.y+ball.dy>canvas.height-ball.r){
    if(ball.x>paddle.x && ball.x<paddle.x+paddle.w){ ball.dy=-ball.dy; playSound("arkanoid-paddle"); }
    else {
      lives--;
      if(!lives){
        clearInterval(game);
        gameOver=true;
        overlay.style.display = "flex";
        gameMessage.textContent = "GAME OVER";
        playSound("game-over"); // game over sound
      } else {
        ball.x=canvas.width/2; ball.y=canvas.height-30; ball.dx=3; ball.dy=-3;
        paddle.x=(canvas.width-paddle.w)/2;
      }
    }
  }

  ball.x+=ball.dx;
  ball.y+=ball.dy;

  if(rightPressed && paddle.x<canvas.width-paddle.w){ paddle.x+=7; }
  else if(leftPressed && paddle.x>0){ paddle.x-=7; }
}

initGame();
</script>
</body>
</html>