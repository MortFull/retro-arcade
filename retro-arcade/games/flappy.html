<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <!-- Back button with sound -->
  <button id="backBtn" onclick="playSound('back'); window.location.href='../index.html'">â¬… Back to Arcade</button>

  <div id="overlay">
    <div class="game-message" id="gameMessage">GAME OVER</div>
    <div class="restart-message">Press Enter to Restart</div>
  </div>

  <canvas id="flappy" width="400" height="600"></canvas>

<script src="../js/sound.js"></script>
<script>
const canvas = document.getElementById("flappy");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");
const gameMessage = document.getElementById("gameMessage");

let bird, pipes, score, gameOver, game;

function initGame(){
  bird = { x:50, y:300, w:20, h:20, dy:0 };
  pipes = [];
  score = 0;
  gameOver = false;
  overlay.style.display = "none";

  clearInterval(game);
  game = setInterval(draw,30);

  // spawn pipes
  setInterval(()=>{
    if(!gameOver){
      let gap = 120;
      let topHeight = Math.random()*300;
      pipes.push({ x:400, y:0, w:40, h:topHeight });
      pipes.push({ x:400, y:topHeight+gap, w:40, h:600-(topHeight+gap) });
    }
  },2000);
}

document.addEventListener("keydown", e=>{
  if(e.key===" "){ 
    bird.dy=-6; 
    playSound("flappy-flap"); // flap sound
  }
  if(e.key==="Enter" && gameOver){ initGame(); }
});

function draw(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // bird
  bird.dy += 0.3;
  bird.y += bird.dy;
  ctx.fillStyle="#ff0";
  ctx.fillRect(bird.x,bird.y,bird.w,bird.h);

  // pipes
  for(let p of pipes){
    p.x -= 3;
    ctx.fillStyle="#0f0";
    ctx.fillRect(p.x,p.y,p.w,p.h);

    // collision
    if(bird.x < p.x+p.w && bird.x+bird.w > p.x && bird.y < p.y+p.h && bird.y+bird.h > p.y){
      endGame("GAME OVER");
    }
  }

  // remove offscreen pipes
  pipes = pipes.filter(p=>p.x+p.w>0);

  // score
  score++;
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,10,20);

  // ground/ceiling collision
  if(bird.y<0 || bird.y+bird.h>canvas.height){
    endGame("GAME OVER");
  }

  // win condition (arbitrary score threshold)
  if(score>=1000){
    endGame("YOU WIN!");
  }
}

function endGame(message){
  clearInterval(game);
  gameOver=true;
  overlay.style.display = "flex";
  gameMessage.textContent = message;
  if(message==="GAME OVER"){
    playSound("game-over"); // collision sound
  } else {
    playSound("win"); // win sound
  }
}

initGame();
</script>
</body>
</html>